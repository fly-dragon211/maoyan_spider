https://github.com/ClayFlannigan/icp/blob/master/icp.py